<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

	<!-- Provide extensions config -->
	<bean id="custom.shareconfigglobal" class="org.springframework.extensions.config.ConfigBootstrap" init-method="register">
		<property name="configService" ref="web.config" />
		<property name="configs">
			<list>
				<value>classpath:share-config-global.xml</value>
			</list>
		</property>
	</bean>

	<!-- Add a custom RessourceBundle -->
	<!-- 
	<bean id="webscripts.resources.custom" class="org.springframework.extensions.surf.util.ResourceBundleBootstrapComponent">
		<property name="resourceBundles">
			<list>
				<value>alfresco.web-extension.messages.i18n</value>
			</list>
		</property>
	</bean>
	 -->

	<!-- Make webscripts JSONP-enabled -->
	<bean id="webscripts.container" parent="webscripts.abstractcontainer" class="org.springframework.extensions.webscripts.LocalWebScriptRuntimeContainer">
		<property name="name">
			<value>Spring Surf Container</value>
		</property>
		<property name="allowCallbacks">
			<value>true</value>
		</property>
		<property name="registry" ref="webscripts.registry" />
		<property name="searchPath" ref="webframework.webscripts.searchpath" />
		<property name="templateProcessorRegistry" ref="webframework.webscripts.registry.templateprocessor" />
		<property name="scriptProcessorRegistry" ref="webframework.webscripts.registry.scriptprocessor" />
		<property name="scriptParameterFactoryRegistry" ref="webscripts.web.scriptparameterfactoryregistry" />
		<property name="configService" ref="web.config" />
		<property name="scriptObjects">
			<map merge="true">
				<entry key="remote" value-ref="webframework.webscripts.scriptremote" />
			</map>
		</property>
		<property name="processorModelHelper" ref="processor.model.helper" />
		<property name="extensibilityModuleHandler" ref="webscripts.extensibility.handler" />
		<property name="urlModelFactory" ref="url.model.factory" />
	</bean>

	<!-- Override Web Framework Abstract Handler Mappings -->
	<bean id="webframeworkHandlerMappings" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping" abstract="true">
		<property name="urlPathHelper" ref="urlPathHelper" />
		<property name="pathMatcher" ref="pathMatcher" />
		<property name="interceptors">
			<list>
				<ref bean="requestContextInterceptor" />
				<ref bean="userDashboardInterceptor" />
				<ref bean="editionInterceptor" />
			</list>
		</property>
		<property name="mappings">
			<value>
				/system/**=remoteController
				/proxy/**=endpointController
				/resource/**=resourceController
				/feed/**=feedController
				/api/**=apiController
				/dologin/**=loginController
				/dologout/**=logoutController
			</value>
		</property>
	</bean>

	<bean id="apiController" class="fr.openwide.demo.share.servlet.SlingshotApiController">
		<property name="cacheSeconds" value="-1" />
		<property name="connectorService" ref="connector.service" />
	</bean>

	<!-- Override FeedController to prefer Basic auth if not authenticated -->
	<!--
	<bean id="feedController" class="fr.openwide.villeurbanne.servlet.AuthAwareSlingshotFeedController">
		<property name="cacheSeconds" value="-1" />
		<property name="useExpiresHeader">
			<value>true</value>
		</property>
		<property name="useCacheControlHeader">
			<value>true</value>
		</property>
		<property name="connectorService" ref="connector.service" />
		<property name="userFactory" ref="webframework.factory.user.slingshot" />
	</bean>
-->

	<!-- Custom placeholder configurer for @{...} properties -->
	<bean id="configurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<!-- C'est le dernier qui l'emporte -->
				<value>classpath:alfresco/web-extension/configuration.properties</value>
				<value>classpath:share-global.properties</value>
			</list>
		</property>
		<property name="ignoreResourceNotFound" value="true" />
		<property name="placeholderPrefix" value="@{" />
	</bean>


</beans>
